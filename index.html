<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover, minimal-ui">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>Tank Adventure</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon/favicon.ico">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Tank Adventure">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#1a1a1a">
    <meta name="theme-color" content="#4a90e2">
    
    <!-- Android TWA Meta Tags -->
    <meta name="display-mode" content="fullscreen">
    <meta name="mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="full-screen" content="yes">
    <meta name="browsermode" content="application">
    
    <!-- Android Chrome specific -->
    <meta name="theme-color" content="#4a90e2" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1a1a1a" media="(prefers-color-scheme: dark)">
    
    <!-- Android TWA immersive mode -->
    <meta name="android-immersive" content="true">
    <meta name="format-detection" content="telephone=no, email=no, address=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="android-app-installable" content="true">
    
    <!-- PWA Builder TWA specific meta tags -->
    <meta name="twa-display-mode" content="fullscreen">
    <meta name="twa-orientation" content="landscape">
    <meta name="twa-status-bar-color" content="#1a1a1a">
    <meta name="twa-navigation-bar-color" content="#1a1a1a">
    <meta name="twa-fullscreen" content="true">
    <meta name="android-layout-fullscreen" content="true">
    <meta name="android-layout-stable" content="false">
    <meta name="android-system-ui-visibility" content="immersive-sticky">
    
    <!-- Additional Android fullscreen meta tags -->
    <meta name="android-windowSoftInputMode" content="adjustNothing">
    <meta name="android-hardwareAccelerated" content="true">
    <meta name="android-allowBackup" content="false">
    <meta name="android-screenOrientation" content="landscape">
    <meta name="android-launchMode" content="singleTask">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="assets/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="167x167" href="assets/favicon/favicon.ico">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Tank Adventure - Epic Tank Battle Game">
    <meta property="og:description" content="Command your tank formation and survive endless waves of enemies! A 2D tank battle game with wave-based combat, skill progression, and strategic gameplay. Play now in your browser!">
    <meta property="og:image" content="https://hoanganh25991.github.io/tank-adventure/assets/background.jpg">
    <meta property="og:image:alt" content="Tank Adventure gameplay screenshot showing tank formation battling enemies">
    <meta property="og:image:width" content="1280">
    <meta property="og:image:height" content="720">
    <meta property="og:url" content="https://hoanganh25991.github.io/tank-adventure/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Tank Adventure">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Tank Adventure - Epic Tank Battle Game">
    <meta name="twitter:description" content="Command your tank formation and survive endless waves of enemies! A 2D tank battle game with wave-based combat, skill progression, and strategic gameplay.">
    <meta name="twitter:image" content="https://hoanganh25991.github.io/tank-adventure/assets/background.jpg">
    <meta name="twitter:image:alt" content="Tank Adventure gameplay screenshot showing tank formation battling enemies">
    <meta name="twitter:site" content="@tankladventure">
    <meta name="twitter:creator" content="@tankladventure">
    
    <!-- Additional Meta Tags for SEO -->
    <meta name="description" content="Tank Adventure is a 2D tank battle game designed for mobile and desktop. Command your tank formation, survive endless enemy waves, upgrade your tanks, and master strategic combat skills.">
    <meta name="keywords" content="tank game, battle game, mobile game, action game, strategy game, tank adventure, wave survival, browser game, HTML5 game">
    <meta name="author" content="Tank Adventure Team">
    <meta name="robots" content="index, follow">
    <meta name="rating" content="general">
    <meta name="distribution" content="global">
    <meta name="revisit-after" content="7 days">
    
    <!-- Game-specific Meta Tags -->
    <meta name="game:developer" content="Tank Adventure Team">
    <meta name="game:genre" content="Action, Strategy">
    <meta name="game:platform" content="Web Browser, Mobile">
    <meta name="game:rating" content="Everyone">
    
    <!-- Additional Open Graph Tags for Rich Snippets -->
    <meta property="og:image:secure_url" content="https://hoanganh25991.github.io/tank-adventure/assets/background.jpg">
    <meta property="og:image:type" content="image/png">
    <meta property="article:author" content="Tank Adventure Team">
    <meta property="article:section" content="Games">
    <meta property="article:tag" content="tank game">
    <meta property="article:tag" content="action game">
    <meta property="article:tag" content="mobile game">
    <meta property="article:tag" content="browser game">
    
    <!-- Schema.org Structured Data for Rich Snippets -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "VideoGame",
      "name": "Tank Adventure",
      "description": "A 2D tank battle game with wave-based combat and skill progression. Command your tank formation and survive endless waves of enemies!",
      "url": "https://hoanganh25991.github.io/tank-adventure/",
      "image": "https://hoanganh25991.github.io/tank-adventure/assets/background.jpg",
      "genre": ["Action", "Strategy"],
      "gamePlatform": ["Web Browser", "Mobile"],
      "operatingSystem": ["Any"],
      "applicationCategory": "Game",
      "offers": {
        "@type": "Offer",
        "price": "1",
        "priceCurrency": "USD"
      },
      "author": {
        "@type": "Organization",
        "name": "Tank Adventure Team"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.5",
        "ratingCount": "100"
      }
    }
    </script>
    
    <!-- Google Fonts - Ghibli Style -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/game.css?v=7.0.0.4">

    <!-- Sentry - Installation -->
    <script src="https://js.sentry-cdn.com/1a40dc41bd2fd09765554e8de7e0264c.min.js" crossorigin="anonymous"></script>
</head>
<body>
    <div id="gameContainer">
        <!-- Main Canvas -->
        <canvas id="gameCanvas"></canvas>
        
        <!-- UI Overlay -->
        <div id="uiOverlay">
            <!-- HUD -->
            <div id="hud">
                <div id="healthBar">
                    <div id="healthFill"></div>
                    <span id="healthText">100/100</span>
                </div>
                <div id="waveInfo">
                    <span id="waveText">Wave 1</span>
                    <span id="enemiesLeft">Enemies: 10</span>
                </div>
                <div id="scoreInfo">
                    <span id="scoreText">Score: 0</span>
                </div>
                <button id="pauseBtn" class="hud-btn">‚öôÔ∏è</button>
            </div>
            
            <!-- Mobile Controls -->
            <div id="mobileControls">
                <!-- Virtual Joystick -->
                <div id="joystickArea">
                    <div id="joystickBase">
                        <div id="joystickStick"></div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div id="actionButtons">
                    <button id="skill1Btn" class="action-btn skill" data-skill="1" data-translate="skill_1">‚ö°</button>
                    <button id="skill2Btn" class="action-btn skill" data-skill="2" data-translate="skill_2">üî•</button>
                    <button id="skill3Btn" class="action-btn skill" data-skill="3" data-translate="skill_3">üí•</button>
                    <button id="primaryShootBtn" class="action-btn primary" data-translate="shoot">üéØ</button>
                </div>
            </div>
            
            <!-- Pause Modal -->
            <div id="pauseModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <h2 data-translate="game_paused">Game Paused</h2>
                    <div class="modal-buttons">
                        <button id="resumeBtn" class="menu-btn" data-translate="resume">‚ñ∂Ô∏è</button>
                        <button id="exitBattleBtn" class="menu-btn" data-translate="exit_to_menu">üö™</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Game Screens -->
        <div id="screens">
            <!-- Orientation Screen -->
            <div id="orientationScreen" class="screen active">
                <div class="orientation-content">
                    <div class="orientation-icon">
                        <svg width="120" height="80" viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
                            <!-- Phone/device outline -->
                            <rect x="10" y="20" width="40" height="70" rx="8" fill="none" stroke="#8b4513" stroke-width="3"/>
                            <rect x="15" y="25" width="30" height="60" rx="2" fill="#c8a882"/>
                            
                            <!-- Rotation arrow -->
                            <path d="M 60 45 Q 75 30 90 45" fill="none" stroke="#8b4513" stroke-width="3" stroke-linecap="round"/>
                            <polygon points="85,40 90,45 85,50" fill="#8b4513"/>
                            
                            <!-- Phone/device outline (rotated) -->
                            <rect x="70" y="10" width="70" height="40" rx="8" fill="none" stroke="#9acd32" stroke-width="3"/>
                            <rect x="75" y="15" width="60" height="30" rx="2" fill="#9acd32" opacity="0.3"/>
                        </svg>
                    </div>
                    <h2 data-translate="rotate_device">Rotate Your Device</h2>
                    <p data-translate="rotate_desc">Please rotate your device to landscape mode for the best gaming experience.</p>
                    <div class="orientation-tip">
                        <p data-translate="rotate_tip">üéÆ Tank Adventure works best in landscape orientation</p>
                    </div>
                </div>
            </div>
            
            <!-- Main Menu -->
            <div id="mainMenu" class="screen">
                <h1 data-translate="game_title">Tank Adventure</h1>
                <button id="startGameBtn" class="menu-btn" data-translate="menu_battle">‚öîÔ∏è</button>
                <button id="upgradesBtn" class="menu-btn" data-translate="menu_base">üè†</button>
                <button id="settingsBtn" class="menu-btn" data-translate="menu_guide">üìñ</button>
            </div>
            
            <!-- Battle Screen (Canvas + UI) -->
            <div id="battleScreen" class="screen">
                <!-- This contains the canvas and mobile controls -->
            </div>
            
            <!-- Skill Selection -->
            <div id="skillSelection" class="screen">
                <h2 data-translate="choose_enhancement">Choose Your Enhancement</h2>
                <div id="skillOptions">
                    <!-- Skill options will be populated from templates -->
                </div>
            </div>
            
            <!-- Battle Results -->
            <div id="battleResults" class="screen">
                <h2 id="battleResultTitle" data-translate="battle_complete">Battle Complete!</h2>
                <div id="resultsContent">
                    <div id="battleStats">
                        <p><span data-translate="wave_reached">Wave Reached</span>: <span id="waveCompleted">1</span></p>
                        <p><span data-translate="enemies_defeated">Enemies Defeated</span>: <span id="enemiesDefeated">0</span></p>
                        <p><span data-translate="score_earned">Score Earned</span>: <span id="scoreEarned">0</span></p>
                        <p><span data-translate="experience_gained">Experience Gained</span>: <span id="expGained">0</span></p>
                    </div>
                </div>
                <div id="resultsButtons">
                    <button id="continueBtn" class="menu-btn" data-translate="continue">‚ñ∂Ô∏è</button>
                    <button id="backToBaseBtn" class="menu-btn" data-translate="back_to_base">üè†</button>
                </div>
            </div>
            
            <!-- Settings/Introduction Screen -->
            <div id="settingsScreen" class="screen">
                <h2 data-translate="tank_guide">Tank Guide</h2>
                <div id="settingsContent">
                    <div class="info-section">
                        <h3 data-translate="language">üåê Language</h3>
                        <div class="language-selector">
                            <button id="englishBtn" class="menu-btn language-btn" data-lang="en">
                                üá∫üá∏
                            </button>
                            <button id="vietnameseBtn" class="menu-btn language-btn" data-lang="vi">
                                üáªüá≥
                            </button>
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <h3 data-translate="welcome_title">üéÆ Welcome to Tank Adventure!</h3>
                        <p data-translate="welcome_desc">Command your tank formation and survive endless waves of enemies. Master your skills and upgrade your tanks to become the ultimate commander!</p>
                    </div>
                    
                    <div class="info-section">
                        <h3 data-translate="how_to_play">üïπÔ∏è How to Play</h3>
                        <div class="control-guide">
                            <div class="control-item">
                                <span class="control-icon">üì±</span>
                                <div class="control-text">
                                    <strong data-translate="movement">Movement:</strong> <span data-translate="movement_desc">Use the virtual joystick to move your tank formation around the battlefield.</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <span class="control-icon">üéØ</span>
                                <div class="control-text">
                                    <strong data-translate="shooting">Shooting:</strong> <span data-translate="shooting_desc">Tap the SHOOT button to fire at enemies. Your tank will auto-aim at the nearest threat!</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <span class="control-icon">‚ö°</span>
                                <div class="control-text">
                                    <strong data-translate="skills">Skills:</strong> <span data-translate="skills_desc">Use SKILL buttons to activate powerful abilities during battle.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <h3 data-translate="desktop_controls">‚å®Ô∏è Desktop Controls</h3>
                        <div class="control-guide">
                            <div class="control-item">
                                <span class="control-icon">üéÆ</span>
                                <div class="control-text">
                                    <strong data-translate="movement">Movement:</strong> <span data-translate="desktop_movement">Use WASD keys (W=Up, A=Left, S=Down, D=Right) to move your tank formation.</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <span class="control-icon">üî•</span>
                                <div class="control-text">
                                    <strong data-translate="shooting">Shooting:</strong> <span data-translate-html="desktop_shooting">Press and hold <strong>SPACEBAR</strong> to continuously fire at enemies.</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <span class="control-icon">‚öôÔ∏è</span>
                                <div class="control-text">
                                    <strong>Game Controls:</strong> <span data-translate-html="desktop_game_controls">Press <strong>ESC</strong> to exit fullscreen mode when playing.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <h3 data-translate="game_features">üèóÔ∏è Game Features</h3>
                        <ul class="feature-list">
                            <li data-translate="feature_formation"><strong>Formation Combat:</strong> Control a main tank with mini-tank escorts</li>
                            <li data-translate="feature_waves"><strong>Wave Survival:</strong> Face increasingly difficult enemy waves</li>
                            <li data-translate="feature_skills"><strong>Skill System:</strong> Choose powerful enhancements between waves</li>
                            <li data-translate="feature_upgrades"><strong>Upgrades:</strong> Improve your tanks at the base between battles</li>
                            <li data-translate="feature_mobile"><strong>Mobile Optimized:</strong> Designed for touch screen gaming</li>
                        </ul>
                    </div>
                    
                    <div class="info-section">
                        <h3 data-translate="tips_success">üí° Tips for Success</h3>
                        <ul class="tips-list">
                            <li data-translate="tip_movement">Keep moving to avoid enemy fire</li>
                            <li data-translate="tip_skills">Use skills strategically during tough moments</li>
                            <li data-translate="tip_upgrades">Upgrade your tanks regularly at the base</li>
                            <li data-translate="tip_choose_skills">Choose skills that complement your playstyle</li>
                            <li data-translate="tip_formation">Position your formation to maximize firepower</li>
                        </ul>
                    </div>
                    
                    <div class="info-section">
                        <h3 data-translate="best_experience">üì± Best Experience</h3>
                        <p class="landscape-note" data-translate-html="landscape_note">
                            For the best gaming experience, rotate your device to <strong>landscape mode</strong> and play in <strong>fullscreen</strong>.
                        </p>
                        <button id="fullscreenBtn" class="menu-btn" data-translate="fullscreen">üì∫</button>
                    </div>
                    
                    <div class="info-section">
                        <h3 data-translate="game_reset">üîÑ Game Reset</h3>
                        <p class="reset-warning" data-translate="reset_warning">
                            Use this button to reset all progress and start from the beginning. This action cannot be undone!
                        </p>
                        <button id="resetGameBtn" class="menu-btn reset-btn" data-translate="reset_game">üîÑ</button>
                    </div>
                </div>
                <button id="backToMenuFromSettingsBtn" class="menu-btn" data-translate="back_to_menu">üè†</button>
            </div>
            
            <!-- Base/Upgrade Screen -->
            <div id="baseScreen" class="screen">
                <h2 data-translate="tank_base">Tank Base</h2>
                
                <!-- Player Stats - Horizontal Layout at Top -->
                <div id="playerStats">
                    <div class="stat-item">
                        <span class="stat-label" data-translate="level">Level</span>
                        <span class="stat-value" id="playerLevel">1</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label" data-translate="experience">Experience</span>
                        <span class="stat-value"><span id="playerExp">0</span> / <span id="playerExpNext">100</span></span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label" data-translate="coins">Coins</span>
                        <span class="stat-value" id="playerCoins">0</span>
                    </div>
                </div>
                
                <div id="baseContent">
                    <div class="upgrades-grid">
                        <div id="tankUpgrades" class="upgrade-category">
                            <h3 data-translate="main_tank">üöó Main Tank</h3>
                            <div class="upgrade-section">
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="armor">‚ù§Ô∏è Armor</span>
                                        <span class="upgrade-current" id="tankHealth">100</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="mainHealth">
                                        <span class="upgrade-cost">100üí∞</span>
                                        <span class="upgrade-bonus">+20</span>
                                    </button>
                                </div>
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="cannon">‚öîÔ∏è Cannon</span>
                                        <span class="upgrade-current" id="tankDamage">10</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="mainDamage">
                                        <span class="upgrade-cost">150üí∞</span>
                                        <span class="upgrade-bonus">+5</span>
                                    </button>
                                </div>
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="engine">üí® Engine</span>
                                        <span class="upgrade-current" id="tankSpeed">5</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="mainSpeed">
                                        <span class="upgrade-cost">200üí∞</span>
                                        <span class="upgrade-bonus">+0.3</span>
                                    </button>
                                </div>
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="auto_loader">üî• Auto-loader</span>
                                        <span class="upgrade-current" id="tankFireRate">100%</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="mainFireRate">
                                        <span class="upgrade-cost">250üí∞</span>
                                        <span class="upgrade-bonus">-10%</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="miniTankUpgrades" class="upgrade-category">
                            <h3 data-translate="mini_tanks">üöô Mini Tanks</h3>
                            <div class="upgrade-section">
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="armor">‚ù§Ô∏è Armor</span>
                                        <span class="upgrade-current" id="miniHealth">50</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="miniHealth">
                                        <span class="upgrade-cost">80üí∞</span>
                                        <span class="upgrade-bonus">+10</span>
                                    </button>
                                </div>
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="weapons">‚öîÔ∏è Weapons</span>
                                        <span class="upgrade-current" id="miniDamage">5</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="miniDamage">
                                        <span class="upgrade-cost">120üí∞</span>
                                        <span class="upgrade-bonus">+2</span>
                                    </button>
                                </div>
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="mobility">üí® Mobility</span>
                                        <span class="upgrade-current" id="miniSpeed">3</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="miniSpeed">
                                        <span class="upgrade-cost">150üí∞</span>
                                        <span class="upgrade-bonus">+0.2</span>
                                    </button>
                                </div>
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="coordination">üéØ Coordination</span>
                                        <span class="upgrade-current" id="miniFireRate">100%</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="miniFireRate">
                                        <span class="upgrade-cost">180üí∞</span>
                                        <span class="upgrade-bonus">-10%</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="formationUpgrades" class="upgrade-category">
                            <h3 data-translate="formation_category">‚ö° Formation</h3>
                            <div class="upgrade-section">
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="tactics">üöÅ Tactics</span>
                                        <span class="upgrade-current" id="formation">5</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="formation">
                                        <span class="upgrade-cost">500üí∞</span>
                                        <span class="upgrade-bonus">+1</span>
                                    </button>
                                </div>
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="coordination">üéØ Coordination</span>
                                        <span class="upgrade-current" id="coordination">100%</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="coordination">
                                        <span class="upgrade-cost">300üí∞</span>
                                        <span class="upgrade-bonus">+10%</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="economyUpgrades" class="upgrade-category">
                            <h3 data-translate="economy_category">üí∞ Economy</h3>
                            <div class="upgrade-section">
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="salvage">üîß Salvage</span>
                                        <span class="upgrade-current" id="coinBonus">100%</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="coinBonus">
                                        <span class="upgrade-cost">200üí∞</span>
                                        <span class="upgrade-bonus">+10%</span>
                                    </button>
                                </div>
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="experience_upgrade">üìö Experience</span>
                                        <span class="upgrade-current" id="expBonus">100%</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="expBonus">
                                        <span class="upgrade-cost">250üí∞</span>
                                        <span class="upgrade-bonus">+10%</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="specialUpgrades" class="upgrade-category">
                            <h3 data-translate="special_category">üåü Special</h3>
                            <div class="upgrade-section">
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="accelerator">üöÄ Accelerator</span>
                                        <span class="upgrade-current" id="bulletSpeed">5</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="bulletSpeed">
                                        <span class="upgrade-cost">300üí∞</span>
                                        <span class="upgrade-bonus">+1</span>
                                    </button>
                                </div>
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="auto_repair_upgrade">üîß Auto-Repair</span>
                                        <span class="upgrade-current" id="autoRepair">0</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="autoRepair">
                                        <span class="upgrade-cost">400üí∞</span>
                                        <span class="upgrade-bonus">+0.5</span>
                                    </button>
                                </div>
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="shield_upgrade">üõ°Ô∏è Shield</span>
                                        <span class="upgrade-current" id="shield">0</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="shield">
                                        <span class="upgrade-cost">600üí∞</span>
                                        <span class="upgrade-bonus">+15</span>
                                    </button>
                                </div>
                                <div class="upgrade-item">
                                    <div class="upgrade-info">
                                        <span class="upgrade-name" data-translate="multi_shot_upgrade">üí• Multi-Shot</span>
                                        <span class="upgrade-current" id="multiShot">0%</span>
                                    </div>
                                    <button class="upgrade-btn" data-upgrade="multiShot">
                                        <span class="upgrade-cost">800üí∞</span>
                                        <span class="upgrade-bonus">+10%</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="baseButtons">
                    <button id="startBattleFromBaseBtn" class="menu-btn action-btn" data-translate="menu_battle">‚öîÔ∏è</button>
                    <button id="backToMenuBtn" class="menu-btn" data-translate="back_to_menu">üè†</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Battle Type Selection Modal -->
    <div id="battleTypeModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-translate="select_battle_type">Select Battle Type</h2>
                <button class="modal-close-btn">‚ùå</button>
            </div>
            <div class="battle-type-options">
                <button class="battle-type-btn" data-type="quick">
                    <span class="battle-icon">‚ö°</span>
                    <div class="battle-info">
                        <span class="battle-name" data-translate="quick_battle">Quick Battle</span>
                        <span class="battle-desc" data-translate="quick_battle_desc">3 Waves</span>
                        <span class="battle-reward"><span data-translate="reward">Reward</span>: x1.0 (x1.3 bonus)</span>
                    </div>
                    <span class="battle-click-hint">‚ñ∂</span>
                </button>
                <button class="battle-type-btn" data-type="standard">
                    <span class="battle-icon">üî•</span>
                    <div class="battle-info">
                        <span class="battle-name" data-translate="standard_battle">Standard Battle</span>
                        <span class="battle-desc" data-translate="standard_battle_desc">5 Waves</span>
                        <span class="battle-reward"><span data-translate="reward">Reward</span>: x1.2 (x1.5 bonus)</span>
                    </div>
                    <span class="battle-click-hint">‚ñ∂</span>
                </button>
                <button class="battle-type-btn" data-type="extended">
                    <span class="battle-icon">üí™</span>
                    <div class="battle-info">
                        <span class="battle-name" data-translate="extended_battle">Extended Battle</span>
                        <span class="battle-desc" data-translate="extended_battle_desc">10 Waves</span>
                        <span class="battle-reward"><span data-translate="reward">Reward</span>: x1.5 (x2.0 bonus)</span>
                    </div>
                    <span class="battle-click-hint">‚ñ∂</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Confirm Dialog Modal -->
    <div id="confirmDialog" class="modal hidden">
        <div class="modal-content confirm-dialog">
            <div class="modal-header">
                <h2 id="confirmTitle" data-translate="confirm_action">Confirm Action</h2>
                <button class="modal-close-btn cancel-btn">‚ùå</button>
            </div>
            <p class="confirm-message" id="confirmMessage" data-translate="are_you_sure">Are you sure?</p>
            <ul class="confirm-bullets" id="confirmBullets"></ul>
            <p class="confirm-warning" id="confirmWarning"></p>
            <div class="confirm-buttons">
                <button class="confirm-btn" data-translate="confirm">‚úÖ</button>
            </div>
        </div>
    </div>
    
    <!-- HTML Templates for Dynamic Content -->
    <div id="templates" style="display: none;">
        <!-- Skill Option Template -->
        <div id="skillOptionTemplate" class="skill-option">
            <div class="skill-emoji"></div>
            <h3 class="skill-name"></h3>
            <p class="skill-description"></p>
            <p class="skill-type"><strong>Type:</strong> <span class="skill-type-value"></span></p>
        </div>
        
        <!-- Damage Text Template -->
        <div id="damageTextTemplate" class="damage-text">
            <span class="damage-value"></span>
        </div>
        
        <!-- Heal Text Template -->
        <div id="healTextTemplate" class="damage-text heal-text">
            <span class="damage-value"></span>
        </div>
        
        <!-- Battle Notification Template -->
        <div id="battleNotificationTemplate" class="notification battle-notification">
            <div class="battle-notification-content"></div>
        </div>
        
        <!-- General Notification Template -->
        <div id="generalNotificationTemplate" class="notification">
            <div class="notification-content"></div>
        </div>
        
        <!-- Flash Effect Template -->
        <div id="flashEffectTemplate" class="skill-cast-flash"></div>
        
        <!-- Bonus Message Template -->
        <div id="bonusMessageTemplate" class="bonus-message">
            <div class="bonus-message-content"></div>
        </div>
    </div>
    
    <!-- Notification Container -->
    <div id="notificationContainer"></div>
    
    <!-- Damage Text Container -->
    <div id="damageTextContainer"></div>
    
    <!-- Flash Effects Container -->
    <div id="flashEffectsContainer"></div>
    
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-content">
            <h2 data-translate="loading">Loading...</h2>
            <div class="loading-bar">
                <div id="loadingProgress"></div>
            </div>
        </div>
    </div>
    
    <!-- Version and Copyright Info -->
    <div id="versionInfo" class="version-info">
        <div class="version-number">v7.0.0.2</div>
        <div class="copyright">made with ‚ù§Ô∏è ¬© 2025</div>
    </div>

    <!-- Sentry - Error Log Tracking -->
    <script>
    Sentry.onLoad(function() {
        Sentry.init({
        integrations: [
            Sentry.replayIntegration(),
        ],
        // Session Replay
        replaysSessionSampleRate: 0.1, // This sets the sample rate at 10%. You may want to change it to 100% while in development and then sample at a lower rate in production.
        replaysOnErrorSampleRate: 1.0, // If you're not already sampling the entire session, change the sample rate to 100% when sampling sessions where errors occur.
        });
    });
    </script>

    <!-- Scripts (optimized loading order) -->
    <script src="js/orientation.js?v=7.0.0.4"></script>
    <script src="js/utils.js?v=7.0.0.4"></script>
    <script src="js/input-manager.js?v=7.0.0.4"></script>
    <script src="js/localization.js?v=7.0.0.4"></script>
    <script src="js/template-manager.js?v=7.0.0.4"></script>
    <script src="js/player.js?v=7.0.0.4"></script>
    <script src="js/enemy.js?v=7.0.0.4"></script>
    <script src="js/skills.js?v=7.0.0.4"></script>
    <script src="js/skill-effects.js?v=7.0.0.4"></script>
    <script src="js/sound-manager.js?v=7.0.0.4"></script>
    <script src="js/ui.js?v=7.0.0.4"></script>
    <script src="js/upgrades.js?v=7.0.0.4"></script>
    <script src="js/quick-actions.js?v=7.0.0.4"></script>
    <script src="js/game-engine.js?v=7.0.0.4"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                if (window.location.protocol == "http:") {
                    console.log("Ignore service-worker on http.")
                    return;
                }
                try {
                    const registration = await navigator.serviceWorker.register('/tank-adventure/sw.js', {
                        scope: '/tank-adventure/'
                    });
                    
                    console.log('Service Worker registered successfully:', registration);
                    
                    // Handle service worker updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // New service worker is available
                                showUpdateAvailable();
                            }
                        });
                    });
                    
                } catch (error) {
                    if (window.location.hostname == "localhost") {
                        console.log("Ignore subpath 'tank-adventure' on localhost")
                        return;
                    }
                    console.error('Service Worker registration failed:', error);
                }
            });
        }
        
        // Force cache clear and reload function
        window.forceCacheReload = async function() {
            console.log('Forcing cache clear and reload...');
            
            // Clear all caches
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                await Promise.all(
                    cacheNames.map(cacheName => {
                        console.log('Deleting cache:', cacheName);
                        return caches.delete(cacheName);
                    })
                );
            }
            
            // Unregister service worker
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                await Promise.all(
                    registrations.map(registration => {
                        console.log('Unregistering service worker');
                        return registration.unregister();
                    })
                );
            }
            
            // Clear localStorage
            localStorage.clear();
            sessionStorage.clear();
            
            // Force reload with cache bypass
            window.location.reload(true);
        };
        
        // Global error handler to catch cache-related errors
        window.addEventListener('error', function(event) {
            const errorMessage = event.message || '';
            const isCacheError = errorMessage.includes('getJoystickInput is not a function') ||
                                errorMessage.includes('removeFromArray is not a function') ||
                                errorMessage.includes('Utils.') && errorMessage.includes('is not a function');
            
            if (isCacheError) {
                console.error('Detected cache-related error - forcing cache reload:', errorMessage);
                
                // Show user-friendly message
                const errorDiv = document.createElement('div');
                errorDiv.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: #dc3545;
                        color: white;
                        padding: 20px;
                        border-radius: 10px;
                        z-index: 10002;
                        text-align: center;
                        box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
                    ">
                        <h3>üîÑ Updating Game...</h3>
                        <p>Clearing cache and reloading latest version...</p>
                    </div>
                `;
                document.body.appendChild(errorDiv);
                
                // Force cache reload after a short delay
                setTimeout(() => {
                    window.forceCacheReload();
                }, 2000);
                
                return true; // Prevent default error handling
            }
        });
        
        // Debug function for manual cache clearing
        window.clearGameCache = window.forceCacheReload;
        
        function showUpdateAvailable() {
            // Create update notification
            const updateNotification = document.createElement('div');
            updateNotification.id = 'updateNotification';
            updateNotification.innerHTML = `
                <div style="
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: linear-gradient(135deg, #28a745, #20c997);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 25px;
                    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
                    z-index: 10001;
                    font-size: 14px;
                    font-weight: 600;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">
                    üîÑ New version available! Click to update
                </div>
            `;
            
            updateNotification.addEventListener('click', () => {
                if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
                    window.location.reload();
                }
            });
            
            document.body.appendChild(updateNotification);
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (updateNotification.parentNode) {
                    updateNotification.parentNode.removeChild(updateNotification);
                }
            }, 10000);
        }
        
        // Handle URL parameters for shortcuts
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');
            
            if (action === 'quick-battle') {
                // Auto-start battle if coming from shortcut
                setTimeout(() => {
                    const startBtn = document.getElementById('startGameBtn');
                    if (startBtn) startBtn.click();
                }, 1000);
            } else if (action === 'base') {
                // Go to base if coming from shortcut
                setTimeout(() => {
                    const baseBtn = document.getElementById('upgradesBtn');
                    if (baseBtn) baseBtn.click();
                }, 1000);
            }
        });
        
        // Cache game data periodically
        function cacheGameData() {
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                try {
                    const gameData = localStorage.getItem('tankAdventureGameData');
                    if (gameData) {
                        navigator.serviceWorker.controller.postMessage({
                            type: 'CACHE_GAME_DATA',
                            gameData: JSON.parse(gameData)
                        });
                    }
                } catch (error) {
                    console.error('Failed to cache game data:', error);
                }
            }
        }
        
        // Cache game data every 30 seconds
        setInterval(cacheGameData, 30000);
        
        // Cache game data when page is about to unload
        window.addEventListener('beforeunload', cacheGameData);
    </script>
</body>
</html>
